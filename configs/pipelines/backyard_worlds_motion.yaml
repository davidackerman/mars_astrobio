# Backyard Worlds Moving Object Detection Pipeline Configuration
# Motion-based approach using optical flow and frame differencing

pipeline_name: "backyard_worlds_motion_detection"
output_dir: "outputs/backyard_worlds_motion"

# If you have already downloaded subjects and metadata, set these to point
# to the existing files to avoid copying or re-downloading.
subjects_csv: "data/subjects_metadata.csv"
subjects_dir: "data/backyard_worlds"

# Encoder type: "motion" for CV-based motion features, "dino" for semantic embeddings
encoder_type: "motion"

# Scorer type: "moving_object" for general movers
scorer_type: "moving_object"

# Panoptes authentication (optional - for higher API rate limits)
panoptes_auth:
  username: null
  password: null

# Download parameters
download:
  limit: 1000  # Number of subjects to download
  subject_set_id: null

# Motion-based encoding configuration
motion_encoding:
  use_optical_flow: true       # Enable dense optical flow computation
  use_ai_features: true         # Enable VideoMAE (requires transformers library)
  device: "cpu"                 # 'cuda' or 'cpu'
  ai_input: "diff"              # 'rgb', 'diff', or 'flow' for VideoMAE input

# HDBSCAN clustering (behavior categories)
clustering:
  min_cluster_size: 50   # Minimum subjects per cluster
  min_samples: 10        # Neighborhood size for core points
  metric: "euclidean"    # Distance metric
  cluster_selection_epsilon: 0.0

# Moving object scoring weights
moving_object_scoring:
  weights:
    motion_magnitude: 0.35      # Increased weight for direct motion measurement
    motion_consistency: 0.30    # Linear vs erratic motion
    temporal_coherence: 0.20    # Object appears in all frames
    novelty: 0.10               # Reduced - less relevant for motion features
    dipole_signature: 0.05      # Reduced - WISE-specific
    artifact_penalty: -0.10     # Penalty for edge effects
    blinker_penalty: 0.0        # Disabled to avoid blanket blinker labeling
    blinker_classifier_penalty: 0.0  # Disabled until detector is tuned

  # If blob persistence is low across the dataset (many zeros),
  # the blinker penalties can dominate. Set these to 0 to disable
  # automatic blanket penalization while you tune the detector.
    

  optimal_motion_magnitude: 0.15
  consistency_threshold: 0.7
  coherence_threshold: 0.6

# Novelty detection
novelty:
  method: "knn"
  k: 10
  use_faiss: true

# Weakly-supervised blinker classifier (AI + CV features)
blinker_classifier:
  enabled: true
  low_persistence_threshold: 0.2
  high_persistence_threshold: 0.8
  min_samples: 50

# Gallery generation
gallery:
  top_n_candidates: 500
  top_k_per_cluster: 10
